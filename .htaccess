# Enable Rewrite Engine
RewriteEngine On

# Set DirectoryIndex - this should route / to index.php
DirectoryIndex index.php index.html

# Serve static files directly (from build/client) - FIRST PRIORITY
# This allows direct access to files that exist
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(.*)$ - [L]

# PHP Proxy Method (Primary - works reliably on cPanel)
# Route all non-file, non-directory requests to index.php which proxies to Node.js
# Exclude test files and build directory
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/build/
RewriteCond %{REQUEST_URI} !^/index\.php$
RewriteCond %{REQUEST_URI} !^/test-proxy\.php$
RewriteCond %{REQUEST_URI} !^/test-index\.php$
RewriteCond %{REQUEST_URI} !^/test-htaccess\.php$
RewriteCond %{REQUEST_URI} !^/test-simple\.php$
RewriteCond %{REQUEST_URI} !^/test-proxy-direct\.php$
RewriteCond %{REQUEST_URI} !^/debug\.php$
RewriteRule ^(.*)$ index.php [L,QSA]

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Disable directory browsing
Options -Indexes

# Set charset
AddDefaultCharset UTF-8
